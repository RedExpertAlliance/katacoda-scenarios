Download Terraform Installer from GitHub https://github.com/robertpeteuil/terraform-installer
`git clone https://github.com/robertpeteuil/terraform-installer`{{execute}}

Run the Terraform installer to install Terraform
`./terraform-installer/terraform-install.sh`{{execute}}

Test the currently installed version of Terraform. This should be at least version v0.10.

`terraform version`{{execute}}

Edit the environment variable values in `environment.sh`{{open}}
Then execute the script to set those environment variables:
```
chmod +777 environment.sh
./environment.sh
export TF_VAR_compartment_id=$(oci iam compartment list | jq -r --arg display_name "lab-compartment" '.data | map(select(."name" == $display_name)) | .[0] | .id')
export TF_VAR_namespace=$(oci os ns get| jq -r '.data')
```{{execute}}

And now initialize the Terraform provider:

`terraform init`{{execute}}

Note: the file `variables.tf` contains the OCI Provider for Terraform. When no variables are defined for the provider, it will attempt to find the file ~/.oci/config and use the settings from the DEFAULT config. When that files exists and has the right entries, you do not need to define fingerprint, tenancy_ocid and other configuration variables in the provider.

Terraform will process all *.tf* files in the current directory (and possibly files in other directories to which references exist).

File `variables.tf`{{open}} contains the OCI provider definition and is also - by convention - the place for global variable definitions and constants that can be used throughout the other *.tf files*. The values of variables can be determined by Terraform in several ways (in this order):
* taken from values passed on the command line through the `-var 'variable-name=value'` syntax 
* in a `.tfvars` file (specified on the command line or automatically loaded)
* read from an Environment Variable called *TF_VAR_name-of-variable*
* taken from the default value

File `main.tf`{{open}} contains the definitions of the OCI resources we want Terraform to make happen. If they exist, Terraform should only update them where properties differ in definition and actual state and if they do not exist, Terraform should create them.

In this file, a single bucket is defined. The name of the bucket is set through the variable *lab_bucket_name*. Its default value is *tf-bucket*. However, the name should be more specific. Execute this command to set an environment variable from which the variable will get its value:

`export TF_VAR_lab_bucket_name=tf_lab_bucket_$LAB_ID`{{execute}}

The following command *plan* is used to create an execution plan. Terraform first performs a refresh: it reads the actual state of affairs on OCI and creates or updates the statefile accordingly. Then it determines what actions are necessary to achieve the desired state specified in the configuration files.

`terraform plan -out config.tfplan`{{execute}}

To make our plan real, use the following command. Terraform will apply the changes required to reach the desired state of the configuration, or the pre-determined set of actions generated by a terraform plan execution plan.

`terraform apply `{{execute}}

Enter *yes* when prompted to confirm our desire.

With the next command, we ask Terraform to show in human-readable output the current state for the resources as Terraform sees it.
`terraform show`{{execute}}

Check in the console if the resource was created as intended:
https://console.us-ashburn-1.oraclecloud.com/object-storage/buckets 

Or use

`oci os bucket list --compartment-id=$compartmentId`{{execute}}

to list all buckets and find the bucket created by Terraform: *tf-bucket*. 

The next command will generate an SVG visualization of the resources managed by Terraform, in a file called graph.svg.

`terraform graph | dot -Tsvg > graph.svg`{{execute}}

You can open the file `graph.svg`{{open}} and copy the contents to the clipboard. Then open an online SVG editor, for example at https://www.freecodeformat.com/svg-editor.php or https://thedevband.com/online-svg-viewer.html  . Copy the contents of the clipboard into the editor and press *Draw* to show the visual representation. 


Note: Any change you made outside of Terraform to resources managed by Terraform will be overwritten the next time you apply the configuration unless you add the *ignore_changes* parameter to the resource in the configuration file.

## Discovery

Beginning with version 3.50, the terraform-oci-provider can be run as a command line tool to discover resources that have been created within Oracle Cloud Infrastructure compartments and generate Terraform configuration files for the discovered resources.

```
mkdir discovery_oci_tf

```{{execute}}

`terraform-provider-oci -command=export -compartment_id=$TF_VAR_compartment_id -output_path=discovery_oci_tf`{{execute}}

.terraform/plugins/linux_amd64/terraform-provider-oci_v3.63.0_x4  -command=export -compartment_id=$TF_VAR_compartment_id -output_path=discovery_oci_tf


## Destroy

Let's remove the resources that we had Terraform create in this scenario. Again, enter *yes* when prompted.
`terraform destroy`{{execute}}


## Resources

GitHub Repo with many sample Terraform configurations for OCI Resources https://github.com/terraform-providers/terraform-provider-oci/tree/master/examples 

Example OCI Terraform Provider - Bucket - https://www.terraform.io/docs/providers/oci/r/objectstorage_bucket.html

Terraform Docs on Variables: https://www.terraform.io/docs/configuration/variables.html 

Resource Discovery: https://www.terraform.io/docs/providers/oci/guides/resource_discovery.html 